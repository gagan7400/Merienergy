<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    .key_benefits {
      width: 100%;
      height: 100vh;
      outline: none;
      border: none;
      /* background:
        linear-gradient(to bottom, rgb(255, 255, 255, 0)37%, rgb(0, 0, 0, 0.1) 53%, rgba(0, 0, 0) 90%),
        url('../imgs/benefits.jpg') center / cover no-repeat; */
      background:
        linear-gradient(to bottom, rgb(255, 255, 255, 0)63%, rgb(0, 0, 0, 0.4) 74%, rgba(0, 0, 0, 1) 86%),
        url('../imgs/benefits.jpg') center / cover no-repeat;
      position: relative;
    }

    .key_benefits::after {
      bottom: -1px;
      content: "";
      position: absolute;
      z-index: 1;
      display: block;
      width: 100%;
      height: 14px;
      background: black;
      /* clear: both; */
    }

    .key_benefits_content {
      width: 100%;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      text-align: center;
      padding-bottom: 50px;
      /* Add some space at bottom */
    }

    .key_benefits_content .content {
      width: 100%;
      color: #fff;
      background: transparent;
      /* No extra background, let gradient show */
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 20px;
    }

    .key_benefits_content .content p {
      color: var(--White, #FFF);
      text-align: center;
      font-feature-settings: 'liga' off, 'clig' off;
      font-family: "Rethink Sans";
      font-size: 20px;
      font-style: normal;
      font-weight: 400;
      line-height: normal;
      width: 60%;
    }

    .key_benefits_content .content h2 {
      color: var(--White);
    }

    .benefits_panel {
      background: #000;
      padding: 40px 0px;
    }

    .benefits_panel .content {
      display: flex;
      height: 550px;
      justify-content: space-around;
      align-items: center;
      padding: 70px 20px;
    }

    .benefits_panel .content .left_panel {
      width: 40%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }


    .benefits_panel .content .right_panel {
      width: 44%;
      height: 100%;
      display: flex;
      border-radius: 8px;
      overflow: hidden;
      justify-content: center;
      align-items: center;
    }

    .benefits_panel .content .left_panel ul {
      display: flex;
      justify-content: space-between;
      align-items: start;
      flex-direction: column;
      padding: 0px;
      margin-top: 10px;
    }

    .benefits_panel .content .right_panel img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 0.4s ease, transform 0.4s ease;
      opacity: 1;
    }

    /* .right_panel img {
    transition: opacity 0.4s ease, transform 0.4s ease;
    opacity: 1;
} */

    .right_panel img.fade-out {
      opacity: 0;
      /* transform: scale(0.98); small zoom out */
    }

    /* NEW inner assumption styles */
    .inner-accordian {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: start;
      gap: 4px;
    }

    .inner-accordian .assumption-toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      user-select: none;
    }

    .inner-accordian .assumption-toggle sup {
      line-height: 1;
    }

    .inner-accordian .assumption-icon {
      transition: transform 0.3s ease;
    }

    .assumption-text {
      height: 0;
      overflow: hidden;
      opacity: 0;
      transition: height 0.3s ease, opacity 0.25s ease;
      will-change: height, opacity;
      color: var(--Gray-gray--6, #C1C3C4);
      font-feature-settings: 'liga' off, 'clig' off;
      font-family: "Rethink Sans";
      font-size: 12px;
      font-style: normal;
      font-weight: 400;
    }

    .left_panel ul li {
      list-style: none;
      color: var(--Gray-gray--8, #5D6266);
      cursor: pointer;
      font-feature-settings: 'liga' off, 'clig' off;
      font-family: "Rethink Sans";
      font-size: 24px;
      font-style: normal;
      font-weight: 500;
      line-height: normal;
      padding: 10px 0;
      transition: color 0.3s;
    }

    /* Accordion content: start hidden; animate height + opacity */

    .accordion-content {
      height: 0;
      overflow: hidden;
      opacity: 0;
      margin-top: 4px;
      transition: height 0.35s ease, opacity 0.35s ease;
      will-change: height, opacity;
      color: var(--White, #FFF);
      font-feature-settings: 'liga' off, 'clig' off;
      font-family: "Rethink Sans";
      font-size: 18px;
      font-style: normal;
      font-weight: 400;
    }

    .accordion-content p {
      color: var(--White, #FFF);
      font-feature-settings: 'liga' off, 'clig' off;
      font-family: "Rethink Sans";
      font-size: 18px;
      font-style: normal;
      font-weight: 400;
      /* line-height: 140%; */

    }

    /* We now put the "active" class on the <li>, not on .accordion-content */
    .left_panel ul li.accordion-active {
      color: var(--White, #FFF);
      font-feature-settings: 'liga' off, 'clig' off;
      font-family: "Rethink Sans";
      font-size: 24px;
      font-style: normal;
      font-weight: 500;
      line-height: normal;
    }

    /* end NEW inner assumption styles */
  </style>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>

<body>
  <section class="benefits_panel">
    <div class="container">
      <div class="content">
        <div class="left_panel">
          <ul>
            <!-- Static Main Heading -->
            <li data-img="./assets/imgs/right_panel.jpg" class="accordion-active">
              Save with reduced/zero electricity bills
              <div class="accordion-content  ">
                Meri Energyâ€™s battery system pays itself back in less than 4 years
                <div class="inner-accordian">
                  <span class="assumption-toggle"><sup>*</sup>Assumptions &nbsp; <img
                      src="./assets/icons/chevron-down.svg" alt="" class="assumption-icon"></span>

                  <p class="assumption-text">50% subsidy via Eco bonus (Italy) spread across 10 years;
                    30% lumpsum subsidy in German markets; Grid electricity price: ~â‚¬0.29/kWh;
                    Self-consumption: Italy - 4,680â€¯kWh/year (PV + 10kW battery) and 2,340â€¯kWh/year
                    (PV only), Germany â€“ 6000 kWh/year (PV + 15kW battery) and 3000â€¯kWh/year (PV
                    only)
                  </p>
                </div>
              </div>
            </li>

            <!-- Accordion Items -->
            <li data-img="./assets/imgs/achieve_energy.jpg">
              Achieve energy independence
              <div class="accordion-content">Every Meri Energy system comes equipped with integrated
                backup for power outages. Also, the monitoring app allows you to monitor and manage your
                energy usage</div>
            </li>
            <li data-img="./assets/imgs/feel_confident.jpg">
              Feel confident with best in class after-sales support
              <div class="accordion-content ">Our technical support is managed directly by our engineers â€”
                ensuring fast, expert, and personalized assistance when you need it. </div>
            </li>
            <li data-img="./assets/imgs/better_place.jpg">
              Make earth a better place
              <div class="accordion-content ">Meri Energy helps you reduce reliance on fossil fuels and
                increase your use of renewable energy. Every installation is a small act with a big
                impactâ€”for your home, your wallet, and the planet. </div>
            </li>
          </ul>
        </div>
        <div class="right_panel">
          <img src="./assets/imgs/right_panel.jpg" alt="">
        </div>
      </div>
    </div>
  </section>
  <script>
    $(function () {
      const $lis = $(".left_panel ul > li");

      // MAIN: open/close accordion item
      $lis.on("click", function (e) {
        if ($(e.target).closest(".inner-accordian").length) return;

        const $li = $(this);
        const $content = $li.children(".accordion-content");
        const imgSrc = $li.data("img");

        // Close others
        $lis.not($li).removeClass("accordion-active")
          .children(".accordion-content").each(function () {
            $(this).stop(true, true).css({ height: 0, opacity: 0 });
          });
        $lis.not($li).find(".assumption-text").css("height", 0);
        $lis.not($li).find(".assumption-icon").css({ transform: "rotate(0deg)" });

        // Toggle current
        const isOpen = $li.hasClass("accordion-active");
        if (isOpen) {
          $li.removeClass("accordion-active");
          $content.stop(true, true).css({ height: 0, opacity: 0 });
        } else {
          $li.addClass("accordion-active");
          const h = $content.get(0).scrollHeight;
          $content.stop(true, true).css({ height: h + "px", opacity: 1 });

          // if (imgSrc) {
          //     $(".right_panel img").attr("src", imgSrc);
          // }

          $(".right_panel img").fadeOut(400, function () {
            $(this).attr("src", imgSrc).fadeIn(300);

          });
        }
      });

      // ASSUMPTIONS: delegated handler
      // $(".left_panel").on("click", ".inner-accordian", function (e) {
      //     e.stopPropagation();
      //     console.log("df")
      //     const $wrap = $(this);
      //     const $text = $wrap.find(".assumption-text");
      //     const $icon = $wrap.find(".assumption-icon");
      //     const $accordionContent = $wrap.closest(".accordion-content");

      //     if ($text.height() > 0) {
      //         // Close assumption
      //         $text.css("height", 0);
      //         $icon.css({ transform: "rotate(0deg)" });
      //     } else {
      //         // Open assumption
      //         const el = $text.get(0);
      //         const h = el.scrollHeight;
      //         $text.css("height", h + "px");
      //         $icon.css({ transform: "rotate(180deg)" });
      //     }

      //     // ðŸ”‘ Recalculate parent accordion-content height
      //     const newHeight = $accordionContent.get(0).scrollHeight;
      //     $accordionContent.css("height", newHeight + "px");
      // });
      // NEW: inner assumption toggle (text or icon click)
      $(".left_panel").on("click", ".assumption-toggle", function (e) {
        e.stopPropagation();
        const $toggle = $(this);
        const $wrap = $toggle.closest(".inner-accordian");
        const $text = $wrap.find(".assumption-text");
        const $icon = $wrap.find(".assumption-icon");
        const $accordionContent = $wrap.closest(".accordion-content");

        const isOpen = $text.height() > 0;

        if (isOpen) {
          $text.css({ height: 0, opacity: 0 });
          $icon.css({ transform: "rotate(0deg)" });
        } else {
          // close any other assumption blocks in this li
          $accordionContent.find(".assumption-text").css({ height: 0, opacity: 0 });
          $accordionContent.find(".assumption-icon").css({ transform: "rotate(0deg)" });

          const fullHeight = $text.get(0).scrollHeight;
          $text.css({ height: fullHeight + "px", opacity: 1 });
          $icon.css({ transform: "rotate(180deg)" });
        }

        // Resize parent accordion smoothly to fit new content
        requestAnimationFrame(() => {
          const newHeight = $accordionContent.get(0).scrollHeight;
          $accordionContent.css("height", newHeight + "px");
        });
      });


      // INITIAL RENDER: open first item
      const $firstLi = $lis.first();
      $firstLi.addClass("accordion-active");
      const $firstContent = $firstLi.children(".accordion-content");
      // Open first accordion
      $firstContent.css({ height: $firstContent.get(0).scrollHeight + "px", opacity: 1 });
      // Also open its inner assumption by default
      const $firstAssumption = $firstContent.find(".assumption-text");
      const $firstIcon = $firstContent.find(".assumption-icon");
      if ($firstAssumption.length) {
        $firstAssumption.css({ height: $firstAssumption.get(0).scrollHeight + "px", opacity: 1 });
        $firstIcon.css({ transform: "rotate(180deg)" });
        // ensure container height fits
        $firstContent.css({ height: $firstContent.get(0).scrollHeight + "px" });
      }
      const firstImgSrc = $firstLi.data("img");
      if (firstImgSrc) {
        $(".right_panel img").attr("src", firstImgSrc);
      }
    });

  </script>

</body>

</html>